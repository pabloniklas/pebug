#!/usr/bin/env python3
import argparse

from modules.Terminal import Terminal
from modules.Pebug import Pebug


def build_argparser() -> argparse.ArgumentParser:
    p = argparse.ArgumentParser(
        prog="pebug",
        description="pebug - x86 DOS-debug-inspired debugger",
    )
    p.add_argument(
        "--wwiv",
        action="store_true",
        help="Usar c√≥digos de color WWIV (|NN) en vez de ANSI.",
    )
    p.add_argument(
        "--no-color",
        action="store_true",
        help="Deshabilitar colores (strip ANSI).",
    )
    p.add_argument(
        "--disk",
        default="pebug_disk.bin",
        help="Archivo de disco virtual (default: pebug_disk.bin).",
    )
    return p


# ====== Entrada CLI ======
if __name__ == "__main__":
    args = build_argparser().parse_args()

    # Terminal: por defecto ANSI
    term = Terminal()

    # Cambiar modo de color por argumento
    if args.no_color:
        term.set_color_mode("none")
    elif args.wwiv:
        term.set_color_mode("wwiv")

    # Pebug
    app = Pebug(term, filename=args.disk)
    app.run()
